(function(){var n,i,t,u,f,r,e;t=require("express"),u=require("http"),e=require("path"),f=require("mkdirp"),r=require("moment"),i=require("everyauth"),i.debug=!0,config.uploadDir=config.uploadDir||e.join(__dirname,"public","user_data","images"),f.sync(config.uploadDir),r.lang("ja"),n=t(),require("../plugins/auth")(n),n.set("port",process.env.PORT||3e3),n.set("views",__dirname+"/views"),n.set("view engine","jade"),n.use(t.favicon()),n.use(t.logger("dev")),n.use(t.bodyParser({uploadDir:config.uploadDir})),n.use(t.cookieParser()),n.use(t.session({secret:config.sessionSecret})),n.use(i.middleware()),n.use(t.static(config.publicPath)),n.use(function(n,t,i){return t.locals({path:n.path}),i()}),n.use(n.router),"development"===n.get("env")&&n.use(t.errorHandler()),n.locals({config:config,moment:r}),require("./routes")(n),exports.active=function(t){return u.createServer(n).listen(t,function(){return console.log("Express server listening on port "+n.get("port"))}),n}}).call(this)