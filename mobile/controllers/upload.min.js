(function(){var t,i,n;t=require("fs"),n=require("path"),i=require("mkdirp"),exports.uploadImage=function(r,u,f){var o,s,e;return r.user?(o=r.files&&r.files.userfile,o&&response.send({status:"failed",message:"no file"}),s=r.user._id.toString(),e=n.join(config.uploadDir,s),i(e,function(i){var r,u;return i?f(i):(r=Date.now()+"_"+o.name,u=n.resolve(n.join(e,r)),u.indexOf(n.resolve(e))!==0)?response.send({status:"forbidden"}):t.rename(fila.path,u,function(n){return n?f(n):response.send({status:"success",url:"/upload/"+s+"/"+encodeURIComponent(r)})})})):response.send({status:"forbidden"})}}).call(this)